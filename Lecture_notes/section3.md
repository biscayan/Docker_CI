# Section3. 직접 도커 이미지를 만들어보기
## 도커 이미지를 생성하는 순서
지금까지는 도커 서버에서 이미지를 받아와 사용하는 방법을 공부했다.  
이미지를 직접 생성하고 사용, 배포까지 할 수 있다. 지금부터 도커 이미지를 생성하는 방법에 대해서 알아보도록 하자.  
도커 이미지는 (1)Dockerfile 작성 (2)도커 클라이언트로 전달 (3)도커 서버로 전달 (4)이미지 생성 순으로 만들어진다.  
## Dockerfile 만들기
Dockerfile이란 도커 이미지를 만들기 위한 설정파일이다. Dockerfile은 컨테이너가 어떻게 행동해야 하는지에 대한 설정들을 정의해준다.  
### Dockerfile 만드는 순서
1. Dockerfile을 만들 폴더를 생성  
2. 생성한 도커파일 폴더를 에디터(e.g. vscode)를 이용하여 실행  
3. Dockerfile을 생성  
4. Dockerfile 안에서 어떻게 진행해 나갈지 토대를 명시  
5. 베이스이미지로부터 실제 값을 추가  
6. 베이스이미지는 ubuntu, centos 등을 써도 되지만 현재는 사이즈가 작은 alpine을 사용  
7. 컨테이너 시작 시 실행될 명령어를 적어 줌  
### FROM, RUN, CMD 등은 도커 서버에서 무엇을 하라고 알려주는 것이다.
- FROM : 이미지 생성 시 기반이 되는 이미지 레이어. <이미지 이름>:<태그> 형식으로 작성한다.  
태그를 안붙이면 자동적으로 가장 최신의 것으로 다운을 받음 e.g. ubuntu:14.04  
- RUN : 도커이미지가 생성되기 전에 수행할 쉘 명령어  
- CMD : 컨테이너가 시작되었을 때 실행할 파일 또는 쉘 스크립트, 해당 명령어는 Dockerfile 내 1회만 쓸 수 있다.  
## Dockerfile로 도커이미지 만들기
Dockerfile이 만들어져 있는 디렉토리에서 $docker build . 를 해준다.  
build명령어는 해당 디렉토리에서 Dockerfile을 자동으로 찾아서 도커 클라이언트에 전달하는 역할을 한다.  
docker build를 하면 베이스이미지에서 다른 종속성이나 새로운 커맨드를 추가할때는 임시 컨테이너를 만든 후, 그 컨테이너를 토대로 새로운 이미지를 만든다.  
새로운 이미지가 생성되면 그 임시컨테이너는 지워지게 된다.  
## 내가 만든 이미지 기억하기 쉬운 이름 주기
docker build를 할 때 -t 도커아이디/프로젝트이름:버전 의 순서로 옵션을 줄 수가 있다.  
$docker build -t skgudwn34/hello:latest .  
이렇게 하면 랜덤으로 발급된 이름이 아닌 자신이 지정한 방식의 이름으로 이미지를 불러 올 수 있다. $docker run skgudwn34/hello:latest